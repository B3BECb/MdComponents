<!DOCTYPE html>
<html lang = "en">
<head>
	<meta charset = "UTF-8">
	<meta name = "viewport"
		  content = "width=device-width, initial-scale=1">
	<meta name = "theme-color"
		  content = "#db5945">
	<script src = "ReferenceAssembler.js"
			type = "text/javascript"></script>
	<style>
		@media (max-width: 600px)
		{
			#test
			{
				width:  100vw !important;
				margin: 0 !important;
			}
		}
	</style>
</head>
<body style = "margin: 0">
<video-player id = "test"
			  style = "width: 600px; height: 300px"></video-player>
</body>
<script>

	Builder
	.RegisterScript("Components/Elements/ValidableInput/ValidableInput.js")
	.RegisterScript("Components/Elements/MaterialSwitch/MaterialSwitch.js")
	.RegisterScript("Components/Elements/Videoplayer/Videoplayer.js")
	.Build()
	.AfterAll(() => Initialize());

	var t = [
		['Trigger 1', 'Trigger 2', 'Trigger 3'], ['id1', 'id2', 'id3'],
	];

	function Initialize()
	{
		var configuration = new VideoplayerConfiguration(
			'http://распознаваниеномеров.рф:5050/api/v1/image?videochannel=1', Videoplayer.Types().Image,
			CreateLayers(),
			'Camera 1 | Real', CreateTriggers());

		BindEvents();

		test.Configure(configuration);

		test.Start();
	}

	function BindEvents()
	{
		// trigger activation
		test.addEventListener('triggerActivated',
			(args) => console.log(`activated trigger: id=${args.detail.TriggerId} name=${args.detail.TriggerName}`));

		// start/stop
		test.addEventListener('playerStarted',
			() => console.log("player started"));
		test.addEventListener('playerStopped',
			() => console.log("player stopped"));

		// expand/collapse
		test.addEventListener('playerExpanded',
			() => console.log("player expanded"));
		test.addEventListener('playerCollapsed',
			() => console.log("player collapsed"));

		//settings open/apply/abort/close/pageChanged
		test.addEventListener('settingsOpened',
			() => console.log("player settings oppened"));
		test.addEventListener('settingsClosed',
			() => console.log("player settings closed"));
		test.addEventListener('settingsApplied',
			(args) =>
			{
				console.log("player settings applied");
				args.detail.CloseLayer();
			});
		test.addEventListener('settingsAborted',
			(args) =>
			{
				console.log("player settings aborted");
				args.detail.CloseLayer();
			});
		test.addEventListener('settingsPageChanged',
			() => console.log("player settings page changed"));

		//settings open/apply/abort/close/pageChanged
		test.addEventListener('recognitionOpened',
			() => console.log("player recognition oppened"));
		test.addEventListener('recognitionClosed',
			() => console.log("player recognition closed"));
		test.addEventListener('recognitionApplied',
			(args) =>
			{
				console.log("player recognition applied");
				args.detail.closeLayer();
			});
		test.addEventListener('recognitionAborted',
			(args) =>
			{
				console.log("player recognition aborted");
				args.detail.closeLayer();
			});
		test.addEventListener('recognitionFrameShowed',
			() => console.log("recognition frame showed"));
		test.addEventListener('recognitionFormShowed',
			() => console.log("recognition form showed"));
		//test.addEventListener('settingsPageChanged',
		//	() => console.log("player recognition page changed"));
	}

	function CreateTriggers()
	{
		var triggrs = [];

		for(var i = 0; i < t[0].length; i++)
		{
			triggrs.push(new VideoplayerTrigger(t[0][i], t[1][i]));
		}

		return triggrs;
	}

	function CreateLayers()
	{
		var pages = [];

		var templetePege = document.querySelector('#tp').content.cloneNode(true);
		templetePege.querySelector('#mdSwitch').addEventListener('valueChanged', () => alert(1));
		pages.push(new LayerPage('Triggers settings', templetePege));

		templetePege = document.querySelector('#tp2').content.cloneNode(true);
		templetePege.querySelector('#plate').addEventListener('valueChanged', (args) => console.info(args.detail));
		pages.push(new LayerPage('test page 2', templetePege));

		var settingsLayer = new VideoplayerLayer('Settings | Test player', pages);
		var layers = new VideoplayerLayers(settingsLayer);
		return layers;
	}
</script>
<template id = "tp">
	<div style = "width: 200px;">
		<div style = "display: flex; flex-direction: row; align-items: center;">
			<span style = "margin-right: 8px;">Отображать триггеры</span>
			<material-switch id = "mdSwitch"></material-switch>
		</div>
	</div>
</template>
<template id = "tp2">
	<div style = "width: 200px;">
		<validable-input id = "plate"
						 title = "plate"
						 noCollapse
						 type = "text"
						 style = "display: block; width: 200px;"></validable-input>
	</div>
</template>
</html>