<!DOCTYPE html>
<html lang = "en">
<head>
	<meta charset = "UTF-8">
	<meta name = "viewport"
		  content = "width=device-width, initial-scale=1">
	<meta name = "theme-color"
		  content = "#db5945">
	<script src = "ReferenceAssembler.js"
			type = "text/javascript"></script>
</head>
<body>
<video-player id = "test"
			  style = "width: 600px; height: 300px"></video-player>
</body>
<script>

	Builder
	.RegisterScript("Components/Elements/ValidableInput/ValidableInput.js")
	.RegisterScript("Components/Elements/MaterialSwitch/MaterialSwitch.js")
	.RegisterScript("Components/Elements/Videoplayer/Videoplayer.js")
	.Build()
	.AfterAll(() => Initialize());

	var t = [
		['1', '2', '3'], ['id1', 'id2', 'id3'],
	];

	function Initialize()
	{
		var configuration = new VideoplayerConfiguration('http://распознаваниеномеров.рф:5050/api/v1/image?videochannel=1', Videoplayer.Types().Image,
			CreateLayers(),
			'Camera 1 | Real', CreateTriggers());

		test.addEventListener('triggerActivated',
			(args) => alert(`${args.detail.TriggerId} ${args.detail.TriggerName}`));


		test.addEventListener('playerStarted',
			() => console.log("player started"));
		test.addEventListener('playerStopped',
			() => console.log("player stopped"));

		test.Configure(configuration);

		test.Start();
	}

	function CreateTriggers()
	{
		var triggrs = [];

		for(var i = 0; i < t[0].length; i++)
		{
			triggrs.push(new VideoplayerTrigger(t[0][i], t[1][i]));
		}

		return triggrs;
	}

	function CreateLayers()
	{
		var templetePege = document.querySelector('#tp').content.cloneNode(true);
		//templetePege.querySelector('#plate').addEventListener('valueChanged', () => alert(123));
		templetePege.querySelector('#mdSwitch').addEventListener('valueChanged', () => alert(1));

		var layers = new VideoplayerLayers([new LayerPage('Plate', templetePege)]);
		return layers;
	}
</script>
<template id = "tp">
	<div style = "width: 200px;">
		<!--<validable-input id = "plate"
						 title = "plate"
						 noCollapse
						 type = "text"
						 style = "display: block; width: 200px;"></validable-input>-->

		<div style = "display: flex; flex-direction: row; align-items: center;">
			<span style = "margin-right: 8px;">Отображать триггеры</span>
			<material-switch id = "mdSwitch"></material-switch>
		</div>
	</div>
</template>
</html>